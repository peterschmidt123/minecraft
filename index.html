<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escape Room: Minecraft Dobrodru≈æstvo - Zlomky 4. roƒçn√≠k</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Segoe UI',Tahoma,sans-serif;color:#fff;background-size:cover;background-position:center;transition:background-image 1s ease;position:relative;}
    .overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);}
    .container{position:relative;z-index:1;max-width:700px;margin:3rem auto;padding:2rem;background:rgba(0,0,0,0.7);border-radius:10px;}
    h1,h2{color:#79c2ff;margin-bottom:1rem;}
    p{margin-bottom:1rem;line-height:1.4;}
    .btn, .mute{background:#79c2ff;color:#000;border:none;border-radius:5px;padding:0.5rem 1rem;cursor:pointer;transition:transform .2s;font-size:1rem;}
    .btn:hover,.mute:hover{transform:scale(1.05);}
    input{padding:0.5rem;width:calc(50% - 1rem);margin-right:1rem;border-radius:4px;border:none;font-size:1rem;}
    #timer{margin-top:1rem;font-weight:bold;}
    #mini-game{text-align:center;}
    .click-block{width:80px;height:80px;background:url('assets/diamond_block.png')center/contain no-repeat;margin:1rem auto;cursor:pointer;}
  </style>
</head>
<body>
  <div class="overlay"></div>
  <audio id="music" src="music/ambient.mp3" loop></audio>
  <audio id="win" src="music/success.mp3"></audio>
  <button class="mute" onclick="toggleMute()">üîä</button>

  <div class="container" id="intro">
    <h1>Escape Room: Minecraft Dobrodru≈æstvo</h1>
    <p>Ocitli ste sa magicky prenesen√≠ do sveta Minecraft. Noc sa bl√≠≈æi a vy potrebujete pre≈æi≈•: z√≠ska≈• drevo, postavi≈• √∫kryt, upiec≈• jedlo, ≈•a≈æi≈• suroviny a akt√≠vova≈• port√°l domov!</p>
    <button class="btn" onclick="startAdventure()">Zaƒça≈• dobrodru≈æstvo</button>
  </div>

  <div class="container hidden" id="task"></div>

  <script>
    // Parser zlomkov a ƒç√≠sel
    function parseAns(str){
      if(str.includes('/')){
        const [n,d] = str.split('/').map(Number);
        return n/d;
      }
      return parseFloat(str);
    }

    const tasks = [
      {
        bg: 'assets/forest.gif',
        title: '√öloha 1: Zlomky s rovnak√Ωm menovateƒæom (sƒç√≠tanie)',
        context: 'Na strome s√∫ 5/8 jah√¥d a na zemi 2/8 jah√¥d. Koƒæko jah√¥d m√°te spolu?',
        inputs: 1,
        question: '5/8 + 2/8 = ?',
        answer: 7/8,
        time: 90
      },
      {
        bg: 'assets/house.gif',
        title: '√öloha 2: Fakle svetla (logick√° h√°danka)',
        context: 'M√°te dve fakle: jedna hor√≠ 5/8 sekundy, druh√° 3/8 sekundy. Keƒè ich spojen√© plamene horia spolu, nov√Ω plame≈à hor√≠ dobu rovnak√∫ ako s√∫ƒçet oboch. Koƒæko sek√∫nd hor√≠ ten nov√Ω plame≈à?',
        inputs: 1,
        question: '5/8 + 3/8 = ?',
        answer: 1,
        time: 90
      },
      {
        bg: 'assets/diamond_cave.gif',
        type: 'click',
        title: 'Minihra: Diamanty',
        context: 'Kliknite na diamantov√Ω blok presne 5-kr√°t, aby ste na≈°li diamanty na craftovanie!',
        clicks: 5,
        time: 60
      },
      {
        bg: 'assets/furnace.gif',
        title: '√öloha 3: Geometria a zlomky (obsah)',
        context: 'M√°te oblas≈• 6 √ó 4 bloky. Pou≈æijete 3/4 tejto oblasti na ovocn√Ω sad. Koƒæko blokov sad zaber√°?',
        inputs: 1,
        question: '(6 √ó 4) √ó (3/4) = ?',
        answer: 18,
        time: 120
      },
      {
        bg: 'assets/mining.gif',
        title: '√öloha 4: Delenie cel√Ωch ƒç√≠sel',
        context: 'M√°te 20 ≈æelezn√Ωch ingotov a rozdel√≠te ich medzi 4 ≈æeleziarov. Koƒæko ingotov dostane ka≈æd√Ω?',
        inputs: 1,
        question: '20 √∑ 4 = ?',
        answer: 5,
        time: 90
      },
      {
        bg: 'assets/portal.gif',
        title: '√öloha 5: Komplexn√° h√°danka',
        context: 'Na aktiv√°ciu port√°lu potrebujete spoƒç√≠ta≈• zlomky a cel√© ƒç√≠sla: najprv sƒç√≠tajte 1/2 + 1/4, v√Ωsledok vyn√°sobte 4, a potom k nemu pripoƒç√≠tajte (20 √∑ 5). Koƒæko m√°te celkom?',
        inputs: 1,
        question: '(1/2 + 1/4) √ó 4 + (20 √∑ 5) = ?',
        answer: 5,
        time: 150
      }
    ];

    let idx = -1, timer, clicks = 0, muted = false;
    const container = document.getElementById('task');
    const intro = document.getElementById('intro');
    const music = document.getElementById('music');

    function toggleMute(){
      muted = !muted;
      music.muted = muted;
      document.querySelector('.mute').textContent = muted ? 'üîá' : 'üîä';
    }

    function startAdventure(){
      music.play().catch(()=>{});
      next();
    }

    function next(){
      idx++;
      clicks = 0;
      if(idx >= tasks.length){ end(); return; }
      render(tasks[idx]);
    }

    function render(t){
      document.body.style.backgroundImage = `url(${t.bg})`;
      container.classList.remove('hidden');
      intro.classList.add('hidden');
      let html = `<h2>${t.title}</h2><p>${t.context}</p>`;
      if(t.type === 'click'){
        html += `<div id='mini-game'><div class='click-block' onclick='handleClick()'></div><p>0 / ${t.clicks}</p></div>`;
      } else {
        html += `<p><strong>Ot√°zka:</strong> ${t.question}</p><div>`;
        for(let i=0;i<t.inputs;i++) html+=`<input type='text' id='a${i}' placeholder='odpoveƒè'>`;
        html += `</div><button class='btn' onclick='checkAnswer()'>Skontrolova≈•</button>`;
      }
      html += `<div id='feedback'></div><div id='timer'></div>`;
      container.innerHTML = html;
      startTimer(t.time);
    }

    function handleClick(){
      clicks++;
      document.querySelector('#mini-game p').textContent = `${clicks} / ${tasks[idx].clicks}`;
      if(clicks>=tasks[idx].clicks) win();
    }

    function checkAnswer(){
      const t = tasks[idx]; let ok=true;
      for(let i=0;i<t.inputs;i++){
        const v=parseAns(document.getElementById('a'+i).value);
        if(Math.abs(v - t.answer) > 0.01) ok=false;
      }
      if(ok) win(); else document.getElementById('feedback').textContent='‚ùå Sk√∫s znova';
    }

    function startTimer(sec){
      clearInterval(timer);
      let s=sec;
      document.getElementById('timer').textContent=`‚è±Ô∏è ${s}s`;
      timer=setInterval(()=>{s--;document.getElementById('timer').textContent=`‚è±Ô∏è ${s}s`;if(s<=0){clearInterval(timer);document.getElementById('feedback').textContent='‚õî ƒåas vypr≈°al';}},1000);
    }

    function win(){
      clearInterval(timer);
      document.getElementById('feedback').textContent='‚úîÔ∏è Spr√°vne!';
      document.getElementById('win').play();
      setTimeout(next,1000);
    }

    function end(){
      document.body.style.backgroundImage="url('assets/celebration.gif')";
      container.innerHTML=`<h2>üéâ √öspe≈°ne ste unikli! üéâ</h2><p>Vitajte sp√§≈• v ≈°kole.</p>`;
    }
  </script>
</body>
</html>
