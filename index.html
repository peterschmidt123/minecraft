<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Escape Room: Minecraft Dobrodru≈æstvo</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #f2f2f2;
      background-size: cover;
      background-position: center;
      transition: background-image 1s ease-in-out;
    }
    .overlay {
      background-color: rgba(0,0,0,0.6);
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
    }
    .container {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: 3rem auto;
      padding: 2rem;
      background-color: rgba(44,62,80,0.8);
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      animation: fadeIn 1s;
    }
    h1, h2 { color: #00ccff; margin-bottom: 1rem; }
    p { margin-bottom: 1rem; line-height: 1.5; }
    input, button { font-size: 1rem; }
    input[type=text] {
      padding: 0.6rem;
      width: calc(50% - 1rem);
      margin-right: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .start-btn, .next-btn, .mute-btn {
      background-color: #00ccff;
      color: #1a1a1a;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
      transition: transform 0.2s;
    }
    .start-btn:hover, .next-btn:hover, .mute-btn:hover {
      transform: scale(1.05);
    }
    #timer { margin-top: 1rem; font-weight: bold; }
    #mini-game { text-align: center; }
    .click-block {
      width: 100px; height: 100px;
      background: url('assets/diamond_block.png') no-repeat center;
      background-size: contain;
      margin: 1rem auto;
      cursor: pointer;
    }
    .intro-img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <audio id="bg-music" src="music/ambient.mp3" loop></audio>
  <audio id="success-sound" src="music/success.mp3"></audio>
  <button class="mute-btn" onclick="toggleMute()">üîä</button>

  <div class="container" id="intro">
    <img src="assets/minecraft.jpg" alt="Minecraft Dobrodru≈æstvo" class="intro-img">
    <h1>Escape Room: Minecraft Dobrodru≈æstvo</h1>
    <p>
      V ≈°kole ste objavili magick√Ω port√°l, ktor√Ω v√°s vtiahol do sveta Minecraft. Je noc pln√° nebezpeƒçenstva ‚Äì mus√≠te pre≈æi≈•, postavi≈• √∫kryt, z√≠ska≈• jedlo aj zdroje a nakoniec aktivova≈• port√°l domov!
    </p>
    <button class="start-btn" onclick="startAdventure()">Vst√∫p do port√°lu</button>
  </div>

  <div class="container hidden" id="task-container"></div>

  <script>
    const tasks = [
      {
        background: 'assets/forest.gif',
        title: '√öloha 1: Pre≈æitie ‚Äì drevo',
        context: 'Prv√© hviezdy klesaj√∫. Potrebuje≈° drevo na ohe≈à a √∫kryt. M√°≈° 3/4 z√°sob, no potrebuje≈° 5/6. Koƒæko ti ch√Ωba?',
        inputs: ['text'],
        question: '5/6 ‚àí 3/4 = ?',
        answer: 1/12,
        time: 120,
      },
      {
        background: 'assets/house.gif',
        title: '√öloha 2: Stavba √∫krytu',
        context: 'Mus√≠te postavi≈• obdƒ∫≈ænikov√Ω √∫kryt so stranami 8 a 5 blokov. Vypoƒç√≠tajte obvod a obsah.',
        inputs: ['text','text'],
        question: 'Obvod = ?, Obsah = ?',
        answer: [26,40],
        time: 180,
      },
      {
        background: 'assets/diamond_cave.gif',
        title: 'Minihra: N√°jdite diamanty',
        context: 'Kliknite na diamantov√Ω blok presne 5-kr√°t, ne≈æ vypr≈°√≠ ƒças!',
        type: 'click',
        clicksRequired: 5,
        time: 60,
      },
      {
        background: 'assets/furnace.gif',
        title: '√öloha 3: Peƒçenie chleba',
        context: 'Ka≈æd√Ω chlieb potrebuje 3/8 m√∫ky. M√°≈° 5 vrec√∫≈°ok. Koƒæko chleba upiec≈• m√¥≈æe≈°?',
        inputs: ['text'],
        question: '5 √∑ (3/8) = ?',
        answer: 13,
        time: 120,
      },
      {
        background: 'assets/mining.gif',
        title: '√öloha 4: ≈§a≈æba ≈æeleza',
        context: '≈†tvorcov√Ω lom so stranou 12 blokov. Vy≈•a≈æili ste 5/8 rudy. Koƒæko zostalo?',
        inputs: ['text'],
        question: '12¬≤ √ó (3/8) = ?',
        answer: 54,
        time: 150,
      },
      {
        background: 'assets/portal.gif',
        title: '√öloha 5: Port√°l domov',
        context: 'Na aktiv√°ciu port√°lu potrebujete 2/3 z 18 ender per√°l. Koƒæko ich pou≈æijete?',
        inputs: ['text'],
        question: '2/3 √ó 18 = ?',
        answer: 12,
        time: 120,
      }
    ];

    let current = -1, timer, clicks = 0, muted = false;
    const bgMusic = document.getElementById('bg-music');

    function toggleMute(){
      muted = !muted;
      bgMusic.muted = muted;
      document.querySelector('.mute-btn').textContent = muted ? 'üîá' : 'üîä';
    }

    function startAdventure(){
      bgMusic.play();
      nextTask();
    }

    function nextTask(){
      current++;
      clicks = 0;
      if(current >= tasks.length){
        showEnd(); return;
      }
      loadTask(tasks[current]);
    }

    function loadTask(t){
      document.body.style.backgroundImage = `url('${t.background}')`;
      const tc = document.getElementById('task-container');
      tc.classList.remove('hidden');
      tc.innerHTML = '';
      let html = `<h2>${t.title}</h2>
        <p>${t.context}</p>
        <p><strong>Ot√°zka:</strong> ${t.question}</p>`;
      if(t.type === 'click'){
        html += `<div id="mini-game">
          <div class="click-block" onclick="handleClick()"></div>
          <p>0 / ${t.clicksRequired}</p>
        </div>`;
      } else {
        html += `<div id="inputs">`;
        t.inputs.forEach((_,i) => {
          html += `<input type="text" id="ans${i}" placeholder="Odpoveƒè">`;
        });
        html += `</div>
          <button class="next-btn" onclick="checkAnswer()">Skontrolova≈•</button>`;
      }
      html += `<div id="feedback"></div><div id="timer"></div>`;
      tc.innerHTML = html;
      startTimer(t.time);
    }

    function handleClick(){
      clicks++;
      document.querySelector('#mini-game p').textContent = `${clicks} / ${tasks[current].clicksRequired}`;
      if(clicks >= tasks[current].clicksRequired){
        clearInterval(timer);
        playSuccess();
        setTimeout(nextTask, 1000);
      }
    }

    function checkAnswer(){
      const t = tasks[current];
      let ok = true;
      t.inputs.forEach((_,i) => {
        const val = parseFraction(document.getElementById(`ans${i}`).value.trim());
        const ans = Array.isArray(t.answer) ? t.answer[i] : t.answer;
        if(Math.abs(val - ans) > 0.01) ok = false;
      });
      if(ok){
        clearInterval(timer);
        playSuccess();
        setTimeout(nextTask, 1000);
      } else {
        document.getElementById('feedback').textContent = '‚ùå Sk√∫s znova';
      }
    }

    function parseFraction(input){
      if(input.includes('/')){
        const [num, den] = input.split('/').map(Number);
        return num/den;
      }
      return parseFloat(input);
    }

    function startTimer(sec){
      clearInterval(timer);
      let s = sec;
      document.getElementById('timer').textContent = `‚è±Ô∏è ${s}s`;
      timer = setInterval(() => {
        s--;
        document.getElementById('timer').textContent = `‚è±Ô∏è ${s}s`;
        if(s <= 0){
          clearInterval(timer);
          document.getElementById('feedback').textContent = '‚õî ƒåas vypr≈°al';
        }
      }, 1000);
    }

    function playSuccess(){
      document.getElementById('success-sound').play();
      // sem m√¥≈æe pr√≠s≈• anim√°cia pre port√°l alebo level-up
    }

    function showEnd(){
      document.body.style.backgroundImage = "url('assets/celebration.gif')";
      document.getElementById('task-container').innerHTML =
        `<h2>üéâ √öspe≈°ne ste unikli! üéâ</h2>
         <p>Vitaj sp√§≈• v ≈°kole.</p>`;
    }
  </script>
</body>
</html>
