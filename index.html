<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Escape Room: Minecraft Zlomky</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #f2f2f2;
      background: url('assets/minecraft.jpg') center/cover no-repeat;
      position: relative;
      transition: background-image 1s ease-in-out;
    }
    .overlay {
      background: rgba(0,0,0,0.6);
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%; z-index: 0;
    }
    .container {
      position: relative; z-index: 1;
      max-width: 800px; margin: 3rem auto;
      padding: 2rem; background: rgba(44,62,80,0.85);
      border-radius: 12px; box-shadow: 0 0 20px rgba(0,0,0,0.7);
      animation: fadeIn 1s;
    }
    h1, h2 { color: #00ccff; margin-bottom: 1rem; }
    p, pre { margin-bottom: 1rem; line-height: 1.5; white-space: pre-wrap; }
    input[type=text] {
      padding: 0.6rem; width: calc(50% - 1rem);
      margin-right: 1rem; border-radius: 6px; border: 1px solid #ccc;
      font-size: 1rem;
    }
    .start-btn, .next-btn, .mute-btn {
      background: #00ccff; color: #1a1a1a;
      border: none; border-radius: 6px;
      padding: 0.6rem 1.2rem; cursor: pointer;
      margin-top: 1rem; font-size: 1rem;
      transition: transform .2s;
    }
    .start-btn:hover, .next-btn:hover, .mute-btn:hover { transform: scale(1.05); }
    .mute-btn {
      position: fixed; top: 10px; right: 10px; z-index: 2;
    }
    #timer { margin-top: 1rem; font-weight: bold; }
    .hidden { display: none !important; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <audio id="bg-music" src="music/ambient.mp3" loop></audio>
  <audio id="success-sound" src="music/success.mp3"></audio>
  <button class="mute-btn" onclick="toggleMute()">üîä</button>

  <div class="container" id="intro">
    <h1>Prol√≥g: Vtiahnutie do sveta Minecraft</h1>
    <p>
      V ≈°kole ste n√°hodou objavili ukryt√Ω port√°l, ktor√Ω v√°s preniesol do nezn√°meho k√∫ta Minecraftu.
      Okolo v√°s sa rozprestiera divok√Ω les, nad vami sa bl√Ωska tmav√° obloha a ƒçoskoro pr√≠de noc.
      Va≈°ou jedinou ≈°ancou na n√°vrat je postupne plni≈• matematick√© √∫lohy,
      ktor√© aktivuj√∫ magick√© kamene v okol√≠ a nakoniec otvoria port√°l domov.
    </p>
    <button class="start-btn" onclick="startAdventure()">Zaƒça≈• dobrodru≈æstvo</button>
  </div>

  <div class="container hidden" id="task-container"></div>

  <script>
    const tasks = [
      {
        background: 'assets/forest.gif',
        title: '√öloha 1: Stavba tvrze',
        context: `Miesto: ƒåerstvo vyr√∫ban√° l√∫ka pri okraji lesa
Lesn√≠ci v√°m pripravili pl√°ny hradu s hradbou dlh≈°ou 4 a 6 blokov.
Potrebujete najprv zmera≈•, koƒæko blokov budete potrebova≈• na cel√Ω obvod,
a potom z tohto poƒçtu pou≈æi≈• 3/5 na vysok√∫ predn√∫ hradbu, ktor√° v√°s ochr√°ni pred mobmi.`,
        inputs: ['text','text'],
        answer: [20, 12],
        time: 150
      },
      {
        background: 'assets/house.gif',
        title: '√öloha 2: Diamantov√© turnaje',
        context: `Miesto: Vchod do starej bane, hlboko pod tvrƒèou
Keƒè hradba stoj√≠, n√°jdete v bani 12 leskl√Ωch diamantov.
Mnoh√≠ ≈•a≈æiari vs√°dzaj√∫, koƒæko diamantov vy≈•a≈æia za hodinu.
Prv√∫ hodinu ste z√≠skali 2/6 z celku, druh√∫ 1/6.
Mus√≠te spoƒç√≠ta≈•, koƒæko diamantov m√°te spolu a ak√Ω je priemern√Ω zisk za hodinu.`,
        inputs: ['text','text'],
        answer: [6, 3],
        time: 180
      },
      {
        background: 'assets/mining.gif',
        title: '√öloha 3: Noƒçn√° l√∫ka',
        context: `Miesto: Vyƒæakan√° l√∫ka pred ban√≠ckou ≈°achtou
Za br√°nou bane sa ocitnete na l√∫ke 8 √ó 5 blokov.
V noci z nej preletia hordy netopierov a odƒæahƒçia 3/8 plochy.
Vypoƒç√≠tajte celkov√∫ plochu l√∫ky a plochu, ktor√° zostala.`,
        inputs: ['text','text'],
        answer: [40, 25],
        time: 150
      },
      {
        background: 'assets/furnace.gif',
        title: '√öloha 4: Dreven√© dosky',
        context: `Miesto: Star√° diel≈àa s pecami
L√∫ka v√°s privedie k dielni, kde s√∫ stohy kme≈àov.
M√°te 20 kme≈àov, polovicu z nich spracujete na dosky,
priƒçom z ka≈æd√©ho kme≈àa z√≠skate 4 dosky.
Koƒæko dosiek celkom vyrob√≠te?`,
        inputs: ['text'],
        answer: [40],
        time: 120
      },
      {
        background: 'assets/portal.gif',
        title: '√öloha 5: Semen√° √∫spechu',
        context: `Miesto: Skryt√° farmiƒçka za diel≈àou
Z dielne prich√°dzate k opustenej farme s obdƒ∫≈ænikov√Ωm pol√≠ƒçkom 12 √ó 8 blokov.
Star√Ω z√°hradn√≠k nechal semienka len na 1/4 tejto plochy.
Ak chcete pol√≠ƒçko o≈æivi≈• a z√≠ska≈• od neho elix√≠r zdravia,
mus√≠te vypoƒç√≠ta≈•, koƒæko blokov je zasaden√Ωch semienkami.`,
        inputs: ['text'],
        answer: [24],
        time: 120
      },
      {
        background: 'assets/forest.gif',
        title: '√öloha 6: Ploƒçinky z jabƒ∫k',
        context: `Miesto: Kuchy≈àa farmy, kde visia ko≈°√≠ky jabƒ∫k
Na jednu placku potrebujete 3/4 hrnca jabƒ∫k a 1/4 hrnca m√∫ky.
Pripravujete dve placky, aby ste sa posilnili pred noƒçn√Ωm stretnut√≠m s mobmi.
Koƒæko hrncov jabƒ∫k a m√∫ky na to miniete?`,
        inputs: ['text','text'],
        answer: [1.5, 0.5],
        time: 150
      },
      {
        background: 'assets/diamond_cave.gif',
        title: '√öloha 7: Redstone br√°ny',
        context: `Miesto: Ve≈æiƒçka so zlo≈æit√Ωm redstone zapojen√≠m
Vo ve≈æiƒçke s√∫ dve redstone br√°ny.
Prv√° potrebuje 1/3 jednotky redstone, druh√° 2/3 jednotky.
Keƒè spoƒç√≠tate, koƒæko redstone potrebujete spolu, otvor√≠ sa spodn√° mrie≈æka schodov ved√∫cich k port√°lu.`,
        inputs: ['text'],
        answer: [1],
        time: 90
      },
      {
        background: 'assets/portal.gif',
        title: '√öloha 8: Fin√°lna energia',
        context: `Miesto: Spodn√Ω s√°l s port√°lom domov
Ste u port√°lu, ale ch√Ωba mu energia.
Fragmenty energie s√∫ v troch komor√°ch: 1/5, 2/5 a 2/5 jednotky.
Mus√≠te spoƒç√≠ta≈• ich s√∫ƒçet, aktivova≈• port√°lov√© kamene a vr√°ti≈• sa sp√§≈• do ≈°koly!`,
        inputs: ['text'],
        answer: [1],
        time: 120
      }
    ];

    let current = -1, timer, muted = false;
    const intro = document.getElementById('intro'),
          taskContainer = document.getElementById('task-container'),
          bgMusic = document.getElementById('bg-music'),
          successSound = document.getElementById('success-sound'),
          muteBtn = document.querySelector('.mute-btn');

    function toggleMute() {
      muted = !muted;
      bgMusic.muted = muted;
      successSound.muted = muted;
      muteBtn.textContent = muted ? 'üîá' : 'üîä';
    }

    function startAdventure() {
      intro.classList.add('hidden');
      bgMusic.play();
      nextTask();
    }

    function nextTask() {
      current++;
      if (current >= tasks.length) return finishAdventure();
      showPortalTransition();
    }

    function showPortalTransition() {
      taskContainer.classList.add('hidden');
      document.body.style.backgroundImage = "url('assets/portal.gif')";
      setTimeout(loadTask, 1500);
    }

    function loadTask() {
      const t = tasks[current];
      document.body.style.backgroundImage = `url('${t.background}')`;
      taskContainer.classList.remove('hidden');
      taskContainer.innerHTML = `
        <h2>${t.title}</h2>
        <pre>${t.context}</pre>
        <div id="inputs">
          ${t.inputs.map((_, i) => `<input type="text" id="ans${i}" placeholder="Odpoveƒè">`).join('')}
        </div>
        <button class="next-btn" onclick="checkAnswer()">Skontrolova≈•</button>
        <div id="feedback"></div><div id="timer"></div>
      `;
      startTimer(tasks[current].time);
    }

    function checkAnswer() {
      const t = tasks[current];
      let ok = true;
      t.inputs.forEach((_, i) => {
        const val = parseFraction(document.getElementById(`ans${i}`).value.trim());
        const ans = Array.isArray(t.answer) ? t.answer[i] : t.answer;
        if (Math.abs(val - ans) > 0.01) ok = false;
      });
      if (ok) celebrateAndContinue();
      else document.getElementById('feedback').textContent = '‚ùå Sk√∫s znova';
    }

    function celebrateAndContinue() {
      clearInterval(timer);
      bgMusic.pause();
      successSound.currentTime = 0; successSound.play();
      successSound.onended = () => {
        if (!muted) bgMusic.play();
        nextTask();
      };
    }

    function startTimer(sec) {
      clearInterval(timer);
      let s = sec;
      document.getElementById('timer').textContent = `‚è±Ô∏è ${s}s`;
      timer = setInterval(() => {
        s--;
        document.getElementById('timer').textContent = `‚è±Ô∏è ${s}s`;
        if (s <= 0) {
          clearInterval(timer);
          document.getElementById('feedback').textContent = '‚õî ƒåas vypr≈°al';
        }
      }, 1000);
    }

    function parseFraction(s) {
      if (s.includes('/')) {
        const [n,d] = s.split('/').map(Number);
        return n/d;
      }
      return s === '' ? 0 : parseFloat(s);
    }

    function finishAdventure() {
      taskContainer.classList.add('hidden');
      document.body.style.backgroundImage = "url('assets/celebration.gif')";
      taskContainer.innerHTML = `
        <h2>üéâ Port√°l je aktivovan√Ω! üéâ</h2>
        <p>Gratulujeme, va≈°a matematick√° odvaha v√°s zachr√°nila.</p>`;
      taskContainer.classList.remove('hidden');
    }
  </script>
</body>
</html>
