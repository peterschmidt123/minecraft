<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Escape Room: Minecraft Zlomky</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #f2f2f2;
      background-image: url('assets/minecraft.jpg');
      background-size: cover;
      background-position: center;
      transition: background-image 1s ease-in-out;
      position: relative;
    }
    .overlay {
      background-color: rgba(0,0,0,0.6);
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%; z-index: 0;
    }
    .container {
      position: relative; z-index: 1;
      max-width: 800px; margin: 3rem auto;
      padding: 2rem; background: rgba(44,62,80,0.85);
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      animation: fadeIn 1s;
    }
    h1, h2 { color: #00ccff; margin-bottom: 1rem; }
    p { margin-bottom: 1rem; line-height: 1.5; }
    input[type=text] {
      padding: 0.6rem; width: calc(50% - 1rem);
      margin-right: 1rem; border: 1px solid #ccc;
      border-radius: 6px; font-size: 1rem;
    }
    .start-btn, .next-btn {
      background: #00ccff; color: #1a1a1a;
      padding: 0.6rem 1.2rem; border: none;
      border-radius: 6px; cursor: pointer;
      margin-top: 1rem; transition: transform 0.2s;
      font-size: 1rem;
    }
    .start-btn:hover, .next-btn:hover { transform: scale(1.05); }
    .mute-btn {
      position: fixed; top: 10px; right: 10px;
      background: #00ccff; color: #1a1a1a;
      border: none; border-radius: 6px;
      padding: 0.4rem 0.8rem; cursor: pointer;
      z-index: 2; font-size: 1.2rem;
    }
    #timer { margin-top: 1rem; font-weight: bold; }
    #mini-game { text-align: center; margin: 1rem 0; }
    .click-block {
      width: 100px; height: 100px;
      background: url('assets/diamond_block.png') no-repeat center;
      background-size: contain; margin: 0 auto;
      cursor: pointer;
    }
    .hidden { display: none; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <!-- ambientn√° hudba -->
  <audio id="bg-music" src="music/ambient.mp3" loop></audio>
  <audio id="success-sound" src="music/success.mp3"></audio>
  <button class="mute-btn" onclick="toggleMute()">üîä</button>

  <!-- √övod -->
  <div class="container" id="intro">
    <h1>Escape Room: Minecraft Zlomky</h1>
    <p>Ocitli ste sa magicky prenesen√≠ do sveta Minecraft. Noc sa bl√≠≈æi a vy potrebujete pre≈æi≈•: z√≠ska≈• potiony, postavi≈• √∫kryt, rozdeli≈• suroviny, vyrie≈°i≈• logick√© h√°danky a aktivova≈• port√°l sp√§≈• domov!</p>
    <button class="start-btn" onclick="startAdventure()">Zaƒça≈• dobrodru≈æstvo</button>
  </div>

  <!-- Sekcia pre √∫lohy -->
  <div class="container hidden" id="task-container"></div>

  <script>
    const tasks = [
      {
        background: 'assets/forest.gif',
        title: '√öloha 1: Zbieranie potionov',
        context: 'V lese ste z jednej fƒæa≈°e odobrali 2 diely z 6 a potom ƒèal≈°ie 3. Koƒæko dielov fƒæa≈°e m√°te spolu?',
        question: '',
        inputs: ['text'],
        answer: 5/6,
        time: 120
      },
      {
        background: 'assets/house.gif',
        title: '√öloha 2: Ch√Ωbaj√∫ce zlato',
        context: 'Na vyrobenie zlatej helmy potrebujete 4 diely zo 6, ale m√°te iba 1 diel. Koƒæko dielov zlata v√°m ch√Ωba?',
        question: '',
        inputs: ['text'],
        answer: 3/6,
        time: 120
      },
      {
        background: 'assets/diamond_cave.gif',
        title: 'Minihra: N√°jdi diamant',
        context: 'Kliknite na diamantov√Ω blok presne 5-kr√°t, aby ste z√≠skali magick√Ω diamant!',
        type: 'click',
        clicksRequired: 5,
        time: 60
      },
      {
        background: 'assets/mining.gif',
        title: '√öloha 3: Rozdelenie z√°sob',
        context: 'M√°te 6 dielov z√°sob. Str√°≈æca si vezme 1 diel, vy 2 diely a priateƒæ tie≈æ 2 diely. Koƒæko dielov zostane?',
        question: '',
        inputs: ['text'],
        answer: 1/6,
        time: 150
      },
      {
        background: 'assets/portal.gif',
        title: '√öloha 4: Stavba ohrady',
        context: 'Postavili ste ohradu s rozmermi 5 √ó 3 bloky. Koƒæko blokov potrebujete na jej cel√Ω obvod?',
        question: '',
        inputs: ['text'],
        answer: 16,
        time: 90
      },
      {
        background: 'assets/portal.gif',
        title: '√öloha 5: Najsilnej≈°√≠ elix√≠r',
        context: 'M√°te elix√≠ry s r√¥znou silou: 2 diely zo 6, 4 diely zo 6 a 3 diely zo 6. Ktor√Ω je najsilnej≈°√≠?',
        question: '',
        inputs: ['text'],
        answer: 4/6,
        time: 120
      }
    ];

    let current = -1, timer, clicks = 0, muted = false;
    const intro = document.getElementById('intro');
    const taskContainer = document.getElementById('task-container');
    const bgMusic = document.getElementById('bg-music');
    const successSound = document.getElementById('success-sound');
    const muteBtn = document.querySelector('.mute-btn');

    function toggleMute() {
      muted = !muted;
      bgMusic.muted = muted;
      successSound.muted = muted;
      muteBtn.textContent = muted ? 'üîá' : 'üîä';
    }

    function startAdventure() {
      intro.classList.add('hidden');
      bgMusic.play();
      nextTask();
    }

    function nextTask() {
      current++;
      clicks = 0;
      if (current >= tasks.length) return finishAdventure();
      showPortalTransition();
    }

    function showPortalTransition() {
      // skry √∫lohu
      taskContainer.classList.add('hidden');
      // uk√°≈æ port√°l na cel√∫ obrazovku
      document.body.style.backgroundImage = "url('assets/portal.gif')";
      setTimeout(loadTask, 1500);
    }

    function loadTask() {
      const t = tasks[current];
      document.body.style.backgroundImage = `url('${t.background}')`;
      taskContainer.classList.remove('hidden');
      // odstr√°nenie predch√°dzaj√∫ceho obsahu
      taskContainer.innerHTML = `
        <h2>${t.title}</h2>
        <p>${t.context}</p>
        ${t.type === 'click'
          ? `<div id="mini-game">
               <div class="click-block" onclick="handleClick()"></div>
               <p id="click-count">0 / ${t.clicksRequired}</p>
             </div>`
          : `<div id="inputs">
               ${t.inputs.map((_,i) => 
                 `<input type="text" id="ans${i}" placeholder="Odpoveƒè">`
               ).join('')}
             </div>
             <button class="next-btn" onclick="checkAnswer()">Skontrolova≈•</button>`}
        <div id="feedback"></div>
        <div id="timer"></div>
      `;
      startTimer(tasks[current].time);
    }

    function handleClick() {
      clicks++;
      document.getElementById('click-count').textContent = `${clicks} / ${tasks[current].clicksRequired}`;
      if (clicks >= tasks[current].clicksRequired) {
        clearInterval(timer);
        celebrateAndContinue();
      }
    }

    function checkAnswer() {
      const t = tasks[current];
      let ok = true;
      t.inputs.forEach((_,i) => {
        const val = parseFraction(document.getElementById(`ans${i}`).value.trim());
        if (Math.abs(val - t.answer) > 0.01) ok = false;
      });
      if (ok) {
        clearInterval(timer);
        celebrateAndContinue();
      } else {
        document.getElementById('feedback').textContent = '‚ùå Sk√∫s znova';
      }
    }

    function celebrateAndContinue() {
      bgMusic.pause();
      successSound.currentTime = 0;
      successSound.play();
      successSound.onended = () => {
        if (!muted) bgMusic.play();
        nextTask();
      };
    }

    function startTimer(sec) {
      clearInterval(timer);
      let s = sec;
      document.getElementById('timer').textContent = `‚è±Ô∏è ${s}s`;
      timer = setInterval(() => {
        s--;
        document.getElementById('timer').textContent = `‚è±Ô∏è ${s}s`;
        if (s <= 0) {
          clearInterval(timer);
          document.getElementById('feedback').textContent = '‚õî ƒåas vypr≈°al';
        }
      }, 1000);
    }

    function parseFraction(s) {
      if (s.includes('/')) {
        const [n,d] = s.split('/').map(Number);
        return n/d;
      }
      return parseFloat(s) || 0;
    }

    function finishAdventure() {
      taskContainer.classList.add('hidden');
      document.body.style.backgroundImage = "url('assets/celebration.gif')";
      taskContainer.innerHTML = `
        <h2>üéâ √öspe≈°ne ste aktivovali port√°l domov! üéâ</h2>
        <p>Gratulujeme, va≈°a matematick√° bystros≈• v√°s zachr√°nila.</p>`;
      taskContainer.classList.remove('hidden');
    }
  </script>
</body>
</html>
